//====================================================================
//ステージトラップスクリプト
//[17013][異－メイン③]
//====================================================================

#ScriptTable

//--------------------------------------------------------------------
//■グローバルフラグ・ルートフラグはev70112.txt参照

//■ローカルフラグ
// 100 ①ゴングを鳴らした。⑤敵⑥敵７敵が出現
// 102 ②球石③球石を破壊
// 103 ⑩敵が出現
// 112 レバースイッチを押した

#FR_71x_RabitDied		2100	// うさぎが死んだ
#FR_711_RabitDone		2101	// うさぎを穴に追い込んだ1
#FR_712_RabitDone		2102	// うさぎを穴に追い込んだ2
#FR_712_FatDone			2103	// 体重ギミック成功 簡易スクリプトで使っているので変更不可
#FR_713_RabitDone		2104	// うさぎをお茶会へ到達させた
#FR_712_Talk1st			2105	// 

// 三月ウサギ
#TAKARA_CH	49
#IT_TAKARA	109		//◇109アナログ時計

// トレジャー
#TREASURE_CH	47
#Fx_TREASURE	2310	//☆010ダイヤモンド

INIT
{
//環境SE
	SE(68,0)

//■地形

//  -------  no typ   	  tip      x    y   z       mot     向 状  000+++++++010+++++++020+++++++030+++++++040+++++++050+++++++060+++++++070+++++++080+++++++090+++++++100+++++++110+++++++120+++++++130+++++++140+++++++150+++++++160+++++++170+++++++180+++++++190+++++++200+++++++210+++++++220+++++++230+++++++240+++++++250++
//■階段・扉
	set_chr( 90,990,	 9, 2,     0,  50,  0,		  0,  0201, 6,"K0_1;")	//①エントリ メイン②
	set_obj("@obx0102a", 9, 2,     0,   0,  0,		  0)					//①階段下（異１）
	set_chr(190,1300,	 9, 2,     0,   0,  0,		  0,     0, 0,";")		//階段下（ダミー）

	set_chr( 91,990,	 2, 4,     0,  50,  0,		  0,  0201, 6,"K0_17019;")	//②エントリ メイン終
	set_obj("@obx0122a", 2, 4,     0,   0,  0,		  0)					//②アーチ（異１）
	set_chr(109,622,	 2, 4,     0,   0,  0,		  0,     0, 0,";")		//②ゴール用天使
	set_chr(191,1400,	 2, 4,     0,   0,  0,		  0,     0, 0,";")		//アーチ（ダミー）

	set_chr( 92,990,	 9, 7,     0, 100,100,		  0,   135, 0,";")	// うさぎ穴から来た

	set_chr( 50,509,	 9, 3,     0,-450,  0,		  6,     0, 0,";")	//③扉（異１） 開放
	set_chr( 51,509,	 9, 4,     0, 450,  0,		  8,     0, 6,";")	//④扉（異１） 一通
	set_chr( 52,509,	 7, 6,     0,-900,  0,		  7,     0, 0,";")	//⑤扉（異１） 閉鎖
	set_chr( 53,509,	 5, 7,     0,-900,  0,		  8,     0, 6,";")	//⑥扉（異１） 一通

//■スイッチ・看板
	set_chr( 55,665,	 9, 3,     0, 900,  0,		  2,     0, 8,"M3?99 SF100;")		//①ゴング

	set_chr( 58,657,	 7, 6,  -200,-650,  0,		  0,   270, 0,";")	//②ハテナ看板
	set_chr( 59,804,	 7, 6,  -200,-650,115,		  0,   270, 8,"(L2?99 [9991うさぎ専用] WT?20 L2!99 [9903] WT?30);")	//②看板

//■ハニワ・壷

	if ( !F2170 )
	{
		set_chr( 40,802,	10, 6,     0,   0,  0,		  2,     0, 0,"I_$$$1 SF2170 V4_140;")	//①壷
		set_chr(140,811,	10, 6,     0,   0,  0,		 -1,     0, 0,";")
	}
	else
	{
		set_chr(140,811,	10, 6,     0,   0,  0,		  0,     0, 0,";")
	}


	if ( !F2171 )
	{
		set_chr( 41,802,	 5, 5,     0,   0,  0,		  2,     0, 0,"I_$$$1 SF2171 V4_141;")	//②壷
		set_chr(141,811,	 5, 5,     0,   0,  0,		 -1,     0, 0,";")
	}
	else
	{
		set_chr(141,811,	 5, 5,     0,   0,  0,		  0,     0, 0,";")
	}


	if ( !F2172 )
	{
		set_chr( 42,802,	 4, 6,     0,   0,  0,		  2,     0, 0,"I_$$$1 SF2172 V4_142;")	//③壷
		set_chr(142,811,	 4, 6,     0,   0,  0,		 -1,     0, 0,";")
	}
	else
	{
		set_chr(142,811,	 4, 6,     0,   0,  0,		  0,     0, 0,";")
	}


	if ( !F2173 )
	{
		set_chr( 43,802,	 3, 6,  -900,   0,  0,		  2,    45, 0,"I_$$$1 SF2173 V4_143;")	//④壷
		set_chr(143,811,	 3, 6,  -900,   0,  0,		 -1,    45, 0,";")
	}
	else
	{
		set_chr(143,811,	 3, 6,  -900,   0,  0,		  0,    45, 0,";")
	}


	if ( !F2174 )
	{
		set_chr( 44,802,	 3, 8,  -900,   0,  0,		  2,   120, 0,"I_$$$1 SF2174 V4_144;")	//⑤壷
		set_chr(144,811,	 3, 8,  -900,   0,  0,		 -1,   120, 0,";")
	}
	else
	{
		set_chr(144,811,	 3, 8,  -900,   0,  0,		  0,   120, 0,";")
	}


//■宝箱
	// ここだけ例外的にスロットが48
	//レベルプレート使用時
	if( GW_LV_PLATE )
	{
		//F2985　を　あいてるルート内フラグに変更してください。（西08_09_25
		set_chr( 48,626,		 2, 5,     0,   0,  0,		  0,     0,10,"!F2149 I_SLOT SF2149 <EV_SlotDarken48>;")	//②スロットマシン
		if (F2149)
		{
		// ここだけ例外的にスロットが48
			MOT( 48, 3, 1);
			EV("EV_SlotDarken48")
		}
	}
	else
	{
		set_chr( 48,626,		 2, 5,     0,   0,  0,		  0,     0,10,"!F2985 I_SLOT SF2985 <EV_SlotDarken48>;")	//②スロットマシン
		if (F2985)
		{
		// ここだけ例外的にスロットが48
			MOT( 48, 3, 1);
			EV("EV_SlotDarken48")
		}
	}

	if( !Fx_TREASURE )
		set_chr( TREASURE_CH,561,	 7, 4,     0,-150,  0,		  6,     0,20,"<TK_TREASURE>;")
	else
		set_chr( TREASURE_CH,561,	 7, 4,     0,-150,  0,		  7,     0, 0,";")

//■罠・障害物
//  -------  no typ   	  tip      x    y   z       mot     向 状  000+++++++010+++++++020+++++++030+++++++040+++++++050+++++++060+++++++070+++++++080+++++++090+++++++100+++++++110+++++++120+++++++130+++++++140+++++++150+++++++160+++++++170+++++++180+++++++190+++++++200+++++++210+++++++220+++++++230+++++++240+++++++250++
	if ( !F2136 )
		set_chr( 65,630,	 8, 7,   900,-150,  0,		  2,     0, 0,"I_FFF1 SF2136;")	//①樽
	else
		set_chr( 65,630,	 8, 7,   900,-150,  0,		  2,     0, 0,"I_$$$1;")	//①樽

	set_chr( 66,710,	 5, 6,     0,   0,350,		  2,     0, 8,"       (R4_200);")	//②球石（破壊可）
	set_chr( 67,710,	 5, 6,     0,   0,350,		  2,     0, 8,"WT?037 (R4_200);")	//③球石（破壊可）
	set_chr( 68,710,	 5, 6,     0,   0,350,		  2,     0, 8,"WT?074 (R4_200);")	//④球石（破壊可）
	set_chr( 69,990,	 5, 6,     0,   0,  0,		  0,     0, 8,"F66 F67 F68 #3_80 SF102;")

	set_chr( 57,571,	 5, 6,     0,   0,625,		  6,   270, 5,"M!_99")	//④レバースイッチ
		chr_equip_chr( 57, 66,"BS_452", 100,    0,0,0,		0,0, 275);


//■敵
	set_chr(11,279,		 9, 3,  -300, 250,  0,		 -1,    90, 8,"F100 WT?05 V2_99;")	//⑤敵a くろうぃすぷ
	set_chr(12,279,		 9, 3,   300, 250,  0,		 -1,   270, 8,"F100 WT?05 V2_99;")	//⑤敵b くろうぃすぷ
	set_chr(13,151,		 9, 3,  -850,   0,  0,		 -1,   270, 8,"F100 WT?25 V2_99;")	//⑥敵a そるじゃー
	set_chr(14,151,		 9, 3,   850,   0,  0,		 -1,    90, 8,"F100 WT?25 V2_99;")	//⑥敵b そるじゃー
	set_chr(15,145,		 9, 4,     0, -50,400,		 -1,   180, 8,"F100 WT?15 V1_99;")	//⑦敵 とらんぷまん

	set_chr(18,146,		 9, 6,     0, 200,  0,		  2,   135, 0,";")	//⑦敵 がーでぃあん
	set_chr(19,279,		 8, 6,     0,   0,  0,		  2,   135, 0,";")	//⑧敵 くろうぃすぷ

	set_chr(21,145,		 5, 6,  -600,   0,400,		 -1,    90, 8,"F103 WT?15 V1_99;")	//⑩敵a とらんぷまん
	set_chr(22,145,		 5, 6,     0,-600,400,		 -1,   180, 8,"F103 WT?25 V1_99;")	//⑩敵b とらんぷまん
	set_chr(23,145,		 5, 6,   600,   0,400,		 -1,   270, 8,"F103 WT?35 V1_99;")	//⑩敵c とらんぷまん
	set_chr(24,145,		 5, 6,     0, 600,400,		 -1,     0, 8,"F103 WT?45 V1_99;")	//⑩敵d とらんぷまん

	set_chr(25,146,		 3, 7,  1100,   0,  0,		  2,   270, 0,";")	//⑪敵a がーでぃあん
	set_chr(26,146,		 3, 7,   700,   0,  0,		  2,   270, 0,";")	//⑪敵b がーでぃあん

	set_chr(27,279,		 2, 7,     0,   0,  0,		  2,     0, 0,";")	//⑫敵a くろうぃすぷ
	set_chr(28,279,		 2, 6,   900,   0,  0,		  2,     0, 0,";")	//⑫敵b くろうぃすぷ
	set_chr(29,279,		 2, 8,   900,   0,  0,		  2,     0, 0,";")	//⑫敵c くろうぃすぷ

//■イベント
	EV("EV_SphereStone")

	// ①球石
	set_chr( 80,990,	 5, 6,     0,   0,  0,		  0,031111, 7,"z9_98")	// 揺れ浮上 

	// 敵の部屋1
	if(WK_ENTRY==91)//階段91 から来た時（帰り）
	{
		set_chr( 81,990,	 0, 0,    0,  0,  0, 	  0,     0, 8,"F100 M5_50 F11 F12 F13 F14 F15 WT?10 O1_18 WT?20 C0_50 WT?20 M4_50 M4_51 WT?30 C0_0;")//①ボタンスイッチを押すと扉
	}
	else
	{
		set_chr( 81,990,	 0, 0,    0,  0,  0, 	  0,     0, 8,"F100 M5_50 F11 F12 F13 F14 F15 WT?10 O1_18 WT?20 C0_51 WT?20 M4_50 M4_51 WT?30 C0_0;")//①ボタンスイッチを押すと扉
	}

	// 敵の部屋2
	set_chr( 83,990,	 5, 6,     0,   0,  0,		  0,050909, 6,"SF103;")

	// ②球石破壊スイッチ落下
	set_chr( 79,990,	 0, 0,     0,   0,  0,		  0,     0, 8,"F66 <EV_SwitchFall>;")

	// スイッチと扉
	set_chr(185,990,	 0, 0,     0,   0,  0,		  0,     0, 8,"(M7?57 SF112 WT?10 M4_53 M6?57 WT?10 M5_53);")//

	if ( !F2135 )
	{
		set_chr(186,990,	 0, 0,     0,   0,  0,		  0,     0, 8,"F112 O1_18 SF2135;")	// スイッチ音（初回）
	}

	//三月うさぎ
	// 1,49,88,87,86
	if ( !FR_71x_RabitDied )
	{
		if ( FR_711_RabitDone )
		{
			if ( FR_712_RabitDone )
			{
				//■敵
				if ( FR_713_RabitDone )
				{
				// お茶会場
					set_chr( 1,289,		 7, 4,     0, 400,  0,		  2,   180, 0,"<EV_RabitFinish>;")	//①敵 わーらびっと 三月ウサギ  Lv15
				}
				else
				{
					if ( !F2120 )
					{
					// 入口
						set_chr( 1,289,		 9, 7,  -150,-150,  0,		  2,   180, 0,"<EV_RabitFinish>;")	//①敵 わーらびっと 三月ウサギ  Lv15
					}
					else
					{
					// うさぎ扉
						set_chr( 1,289,		 7, 5,     0, 500,  0,		  2,   180, 0,"<EV_RabitFinish>;")	//①敵 わーらびっと 三月ウサギ  Lv15
					}
		//			set_chr( 1,289,		 7, 6,     0,   0,  0,		  2,   180, 0,"<EV_RabitFinish>;")	//①敵 お茶会扉前
		//			set_chr( 1,289,		 7, 5,     0,   0,  0,		  2,   180, 0,"<EV_RabitFinish>;")	//①敵 お茶会扉後
				}
				if(IT_TAKARA<0)
				{
					set_chr( 49,560,	10, 5,   250,   0,  0,		  6,   270,20,"<TK_TAKARA>;")	//①宝箱（上）ロック
					set_chr(171,990,	 0, 0,     0,   0,  0,		  0,     0, 8,"F1 [0103] #3_88 WT?10 O1_18 <EV_RabitBoxFall> WT?27 #2_49;")	//宝箱を落とし、開けるようにする
				}
				else
				{
					set_chr( 49,560,	10, 5,   250,   0,  0,		  7,   270, 0,";")				//①宝箱（上）空
					set_chr(171,990,	 0, 0,     0,   0,  0,		  0,     0, 8,"F1 [0103] #3_88 WT?10 O1_18 <EV_RabitBoxFall> WT?27;")	//空箱
				}

				chr_equip_chr( 49, 1,"Bone_Spine", 100,   90,0,0,		0,  250, 0);	//背負う箱

				//■イベント
				// セリフを出しているのは宝箱
				if (FR_713_RabitDone)
				{
					// セリフを黙らせる
					set_chr( 88,990,	 0, 0,     0,   0,  0,		  0,     0, 8,"#3_49;")//ダミー
				}
				else
				{
					set_chr( 88,990,	 0, 0,     0,   0,  0,		  0,     0, 8,"#3_49 (WT?30 L9?0100 [0120お茶会に遅れちゃう！] WT?60[0103] WT?30 L9?0100 [0120お部屋どこよ！？]WT?60[0103] WT?120);")//せりふ

					// 到達判定-お茶会
					set_chr( 87,990,	 7, 4,     0,   0,  0,		  0,     0, 8,"L7?9901 !F1 O1_18 #3_88 <EV_Set713RabitDone> [0103] [0110着いた～] WT?60[0103];")	// うさぎ到達

					// 到達判定-扉
					if ( !F2120 )
					{
						set_chr( 86,990,	 0, 0,     0,   0,  0,		  0,     0, 8,"L3?5201 !F1 O1_18 WT?10 C0_52 WT?20 M4_52 WT?30 C0_0 SF2120;")	// うさぎ到達
					}
				}

				EV("EV_RabitInit")
			}
		}
	}

	// うさぎ扉
	if ( F2120 )
	{
	// 開き済
		MOT( 52, 6, 0 )
	}


	set_chr( 2,255,		 7, 4,   100, 125,  0,		  6,     0, 0,";")	//②敵 もりこぼると 帽子屋 Lv8 + 9 = Lv17
		chr_state_LV(2, 8);
		chr_equip2( 2,	"eq_051",	"Bone_RightHand", 100,		105,0,10,	0,10,0);
		chr_equip2( 2,	"eq_057",	"Bone_Head", 100,		0,0,0,	0,0,0);

	set_chr( 3,139,		 7, 4,  -100, 125,  0,		 -2,   180, 0,";")	//③敵 すなもぐら 眠り鼠 Lv3 + 11 = Lv14
		chr_state_LV(3, 11);
		chr_equip2(3,	"eq_051",	"Bone_RightArm03", 100,		105,-10,0,	0,10,0);

	set_chr( 4,267,		 7, 4,  -100,-200,400,		  6,     0, 0,";")	//④敵a おうごんばっと Lv13
	set_chr( 5,267,		 7, 4,   100,-200,400,		  6,     0, 0,";")	//④敵b おうごんばっと Lv13

//■場面固有設定
}

//--------------------------------------------------------------------
EV_RabitInit
{
	color( 49,-1)		// 透明に
	F_set_chr( 49,		CF_NO_MINIMAP)	// 宝箱 ミニマップ非表示
	F_set_chr( 49,		CF_NO_CSP)
}

//--------------------------------------------------------------------
EV_RabitFinish
{
	color( 49,30)		// 不透明に
	F_reset_chr( 49,	CF_NO_MINIMAP)	// 宝箱 ミニマップ表示
	F_reset_chr( 49,	CF_NO_CSP)
	F_set(FR_7x_RabitDied);
}

//--------------------------------------------------------------------
EV_RabitBoxFall
{
	// 宝箱落下
	jump( 49,3, 24,-1,-1,0,150)
	wait_move(49)
}

//--------------------------------------------------------------------
EV_Set713RabitDone
{
	F_set(FR_713_RabitDone)
}

//--------------------------------------------------------------------
EV_SwitchFall
{
	// スイッチ落下
	jump( 57,2, 29,0,0,-625,625)
	wait_move(57)
}

//--------------------------------------------------------------------
EV_SphereStone
{
	if ( !F66 )
	{
		EFF_chr(21520, 66, 0, 100, 0,"charbase0")
	}

	if ( !F67 )
	{
		EFF_chr(21520, 67, 0, 100, 0,"charbase0")
	}

	if ( !F68 )
	{
		EFF_chr(21520, 68, 0, 100, 0,"charbase0")
	}

	wait(25)
	loop
}

//--------------------------------------------------------------------
EV_SlotDarken48
{
	wait(15)
	color2( 48, 70,70,70,,0,0,0)		// スロット暗く
}

#EndScriptTable
//====================================================================

