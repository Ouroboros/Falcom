//====================================================================
//ステ`ジトラップスクリプト
//[17012][异－梅ン②]
//====================================================================

#ScriptTable

#MUSHI		2

//--------------------------------------------------------------------
//■グロ`バルフラグ・ル`トフラグはev70112.txt参照

//■ロ`カルフラグ
//x 100 豆球が同rに点灯した
// 101 ③ボタンスイッチを押した
// 104 体重之プレ`トがあがっていて、dっている
// 110 雪玉距x

#FR_71x_RabitDied		2100	// うさぎが死んだ
#FR_711_RabitDone		2101	// うさぎを穴に追いzんだ1
#FR_712_RabitDone		2102	// うさぎを穴に追いzんだ2
#FR_712_FatDone			2103	// 体重ギミック成功 易スクリプトで使っている之で涓不可
#FR_713_RabitDone		2104	// うさぎをお茶会へ到_させた
#FR_712_Talk1st			2105	// 

// 三月ウサギ
#TAKARA_CH	49
#IT_TAKARA	109		//◇109アナログr

// トレジャ`
#TREASURE_CH	48
#Fx_TREASURE	2332	//☆032肉食龙之体

#TREASURE2_CH	48
#Fx_TREASURE2	2340	//☆040	角龙之体

//--------------------------------------------------------------------
INIT
{
//h境SE
	SE(68,0)

//■地形
	F_set_chr(PLAYER1, CF_NO_FALL )
	F_set_chr(PLAYER2, CF_NO_FALL )
	F_set_chr(PET, CF_NO_FALL )

	set_obj("obx0514",   1, 3,     0,   0,  0,	 0) //穴

	set_obj2("mp70122",   5, 3,  -450,-450,  0,	 0) //
	set_obj2("mp70132",   5, 3,   450,-450,  0,	 0) //

	set_obj2("mp70142",   6, 3,  -450, 450,  0,	 0) //
	set_obj2("mp70152",   6, 3,   450, 450,  0,	 0) //

	set_obj2("obx7000k",  5, 3,     0,   0,  0,     0) //↓
	set_obj2("obx7000k",  6, 3,     0,-900,  0,     0) //↓
	set_obj2("obx7000k",  5, 3,     0, 900,  0,   180) //↑
	set_obj2("obx7000k",  6, 3,     0,   0,  0,   180) //↑
	set_obj2("obx7000k",  8, 7,     0,-900,  0,   180) //↑

	set_obj2("mp70022",   7, 9,  -450,-450,  0,	 0) //
	set_obj2("mp70032",   7, 9,   450,-450,  0,	 0) //

	set_obj2("mp70002",   9, 3, -1350, 450,  0,	 0) //
	set_obj2("mp70012",   9, 3,  -450, 450,  0,	 0) //
	set_obj2("mp70022",   9, 3, -1350,1350,  0,	 0) //
	set_obj2("mp70032",   9, 3,  -450,1350,  0,	 0) //

	set_obj2("mp70002",   8, 4, -1350, 450,  0,	 0) //
	set_obj2("mp70012",   8, 4,  -450, 450,  0,	 0) //
	set_obj2("mp70022",   8, 4, -1350,1350,  0,	 0) //
	set_obj2("mp70032",   8, 4,  -450,1350,  0,	 0) //

	set_chr(185,991,	 5, 3,  -300, 450,  0,	 0,0209, 0,";")	// 空荼
	set_chr(186,991,	 5, 3,   300, 450,  0,	 0,0209, 0,";")	// 空荼
	set_chr(187,991,	 6, 3,  -300,-450,  0,	 0,0209, 0,";")	// 空荼
	set_chr(188,991,	 6, 3,   300,-450,  0,	 0,0209, 0,";")	// 空荼

//  -------  no typ   	  tip      x    y   z       mot     向 状  000+++++++010+++++++020+++++++030+++++++040+++++++050+++++++060+++++++070+++++++080+++++++090+++++++100+++++++110+++++++120+++++++130+++++++140+++++++150+++++++160+++++++170+++++++180+++++++190+++++++200+++++++210+++++++220+++++++230+++++++240+++++++250++
//■A段・扉
	set_chr( 90,990,	 9, 8,   -50,   0,  0,		 90,  0102, 6,"K0_1;")	//①エントリ 梅ン①
	set_obj("@obx0102a", 9, 8,     0,   0,  0,		 90)					//①A段下（异１）
	set_chr(190,1300,	 9, 8,     0,   0,  0,		  0,    90, 0,";")		//A段下（ダミ`）

	set_chr( 91,990,	 7, 6,     0, -50,  0,		180,  0201, 6,"K0_0;")	//②エントリ 梅ン③
	set_obj("@obx0112a", 7, 6,     0,   0,  0,		180)					//②A段上（异１）
	set_chr(191,1301,	 7, 6,     0,   0,  0,		  0,   180, 0,";")		//A段上（ダミ`）

	set_chr( 92,990,	 8, 7,     0,-200,  0,		  0,     0, 0,";")	// うさぎ穴から来た

	set_chr( 50,509,	 2, 7,   900,   0,  0,		  7,   270, 0,";")	//③扉（异１） ]i うさぎ扉:
	set_chr( 51,509,	 1, 4,     0,-900,  0,		  7,     0, 0,";")	//④扉（异１） ]i でぶ扉: うさぎ穴前
	set_chr( 52,509,	 4, 6,     0, 450,  0,		  7,   180, 0,";")	//⑤扉（异１） ]i 正常ル`ト1
	set_chr( 53,509,	 7, 5,     0, 450,  0,		  8,     0, 6,";")	//⑥扉（异１） 一通 正常ル`ト2

	set_chr( 97,990,	 1, 3,     0,1000,  0,		180,     0, 0,";")		//うさぎ穴前 出F之み

	// チェックポイント
	set_chr( 89,990,	 1, 3,     0,   0,  0,		  0,070404, 6,"k7_0")	//うさぎ穴前。分到_判定にも使用。

	set_chr( 93,990,	 5, 3,     0,    0, 0,		180,  0301, 6,"k3_0")	//1a
	set_chr( 94,990,	 5, 3,     0,  900, 0,		  0,  0301, 6,"k4_0")	//1b
	set_chr( 95,990,	 6, 3,     0, -900, 0,		180,  0301, 6,"k5_0")	//2a
	set_chr( 96,990,	 6, 3,     0,    0, 0,		  0,  0301, 6,"k6_0")	//2b

//■スイッチ・看板

	set_chr( 61,649,	 1, 4,     0,-350,  0,		  6,     0, 0,";") //①フットスイッチ
	// でぶ
	if ( !FR_712_FatDone )
	{
	// 初回
		set_chr(161,649,	 0, 0,     0,   0,  0,		  5,     0, 9,"RF104 M6?61 L2?6100 SF104")	// プレ`トがあがっていて、dっている
		set_chr(162,990,	 0, 0,     0,   0,  0,		  0,     0, 8,"F2103 WT?10 O1_18 WT?10 C0_51 WT?20 M4_51 WT?30 C0_0;")
	}
	else
	{
	// 押され
		MOT( 61, 7, 0 )
		MOT( 51, 6, 0 )
	}



	// ③ボタンスイッチ
	// ①球石が菠欷皮胜堡欷懈∩抗を有炕
	if ( !F2116 )
	{
	// 初回
		set_chr( 63,570,	 4, 6,     0,   0,  0,		  6,     0, 5,"M6?99 M5_99 SF2116")	//③ボタンスイッチ
		set_chr( 81,990,	 0, 0,     0,   0,  0,		  0,     0, 8,"F2116 O1_18 WT?10 M4_52 !F65 M2_65 #7_80;") // ⑤扉
	}
	else
	{
	// 押され
		set_chr( 63,570,	 4, 6,     0,   0,  0,		  7,     0, 3,";")	//③ボタンスイッチ
		set_chr( 81,990,	 0, 0,     0,   0,  0,		  0,     0, 8,"            M6_52      M2_65 #7_80;") // ⑤扉
	}


	set_chr( 56,657,	 1, 4,  -225,-350,  0,		  0,   270, 0,";")	//②ハテナ看板
	set_chr( 57,804,	 1, 4,  -225,-350,115,		  0,   270, 8,"(L2?99 [9991わたしは巨hが好き] WT?20 L2!99 [9903] WT?30);")	//②看板

	set_chr( 58,657,	 3, 7,  -650,-175,  0,		  0,     0, 0,";")	//②ハテナ看板
	set_chr( 59,804,	 3, 7,  -650,-175,115,		  0,     0, 8,"(L2?99 [9991うさぎ用] WT?20 L2!99 [9903] WT?30);")	//②看板

//■ハニワ・

	if ( !F2160 )
	{
		set_chr( 40,802,	 8, 7,     0,-300,  0,		  2,     0, 0,"I_$$$1 SF2160 V4_140;")	//①
		set_chr(140,811,	 8, 7,     0,-300,  0,		 -1,     0, 0,";")
	}
	else
	{
		set_chr(140,811,	 8, 7,     0,-300,  0,		  0,     0, 0,";")
	}


	if ( !F2161 )
	{
		set_chr( 41,634,	 7, 8,     0, 900,  0,		  2,   180, 0,"I_US01 SF2161 V4_141;")	//②ハニワ
		set_chr(141,812,	 7, 8,     0, 900,  0,		 -1,   180, 0,";")
	}
	else
	{
		set_chr(141,812,	 7, 8,     0, 900,  0,		  0,   180, 0,";")
	}


	if ( !F2162 )
	{
		set_chr( 42,802,	 3, 7,     0, 300,  0,		  2,     0, 0,"I_$$$1 SF2162 V4_142;")	//③
		set_chr(142,811,	 3, 7,     0, 300,  0,		 -1,     0, 0,";")
	}
	else
	{
		set_chr(142,811,	 3, 7,     0, 300,  0,		  0,     0, 0,";")
	}


	if ( !F2163 )
	{
		set_chr( 43,802,	 5, 6,   -375,-375,430,		  2,     0, 0,"I_$$$1 SF2163 V4_143;")	//④
		set_chr(143,811,	 5, 6,   -375,-375,430,		 -1,     0, 0,";")
	}
	else
	{
		set_chr(143,811,	 5, 6,   -375,-375,430,		  0,     0, 0,";")
	}


	if ( !F2164 )
	{
		set_chr( 44,802,	 9, 3,   -350, 350,  0,		  2,     0, 0,"I_$$$1 SF2164 V4_144;")	//⑤
		set_chr(144,811,	 9, 3,   -350, 350,  0,		 -1,     0, 0,";")
	}
	else
	{
		set_chr(144,811,	 9, 3,   -350, 350,  0,		  0,     0, 0,";")
	}


//■宝箱
	if ( GW_LV_PLATE==0 )
	{
		if( !Fx_TREASURE )
			set_chr( TREASURE_CH,561,	 7, 7,     0,   0,  0,		  6,   180,20,"<TK_TREASURE>;")
		else
			set_chr( TREASURE_CH,561,	 7, 7,     0,   0,  0,		  7,   180, 0,";")
	}
	else
	{
		if( !Fx_TREASURE2 )
			set_chr( TREASURE2_CH,561,	 7, 7,     0,   0,  0,		  6,   180,20,"<TK_TREASURE2>;")
		else
			set_chr( TREASURE2_CH,561,	 7, 7,     0,   0,  0,		  7,   180, 0,";")
	}


//■F・障害物
	set_chr( 65,710,	 4, 5,   900, 900,  0,		  1,     0, 0,"#3_80;")	//①球石（破部桑

//  -------  no typ   	  tip      x    y   z       mot     向 状  000+++++++010+++++++020+++++++030+++++++040+++++++050+++++++060+++++++070+++++++080+++++++090+++++++100+++++++110+++++++120+++++++130+++++++140+++++++150+++++++160+++++++170+++++++180+++++++190+++++++200+++++++210+++++++220+++++++230+++++++240+++++++250++
	if(WK_ENTRY==91)//A段91 から来たr（り）
	{
		set_chr( 66,711, 7, 4,  -1050,  0,200,		  1,   270, 5,"M3_99 #8_99 D0_69 T2_99 X5_-1200 <EV_CQ1> T6_99 X5_5850 <EV_CQ1> (T4_99 Y5_1800 <EV_CQ1> T2_99 X5_-1800 <EV_CQ1> T0_99 Y5_-3600 <EV_CQ1> T2_99 X5_-1800 <EV_CQ1> T4_99 Y5_1800 <EV_CQ1> T6_99 X5_3600 <EV_CQ1>);") //②雪球
	}
	else 
	{
		set_chr( 66,711, 7, 4,  -1050,  0,200,		  1,   270, 5,"M3_99 #8_99 D0_69                         T6_99 X5_4650 <EV_CQ1> (T4_99 Y5_1800 <EV_CQ1> T2_99 X5_-1800 <EV_CQ1> T0_99 Y5_-3600 <EV_CQ1> T2_99 X5_-1800 <EV_CQ1> T4_99 Y5_1800 <EV_CQ1> T6_99 X5_3600 <EV_CQ1>);") //②雪球
	}
	set_chr(166,990,     0, 0,     0,  0,   0,		  0,     0, 9,"M1!66 #3_182 #8_183;")// 判定切り替え
	set_chr( 69,991,	 7, 4,  -1050,  0,  0,		  1,070105, 0,";")
	color2( 66, 100, 100,0, 0, 0,0)	// 异次元之雪球之色（月っぽい）

	set_chr( 67,664,	 7, 4,   900, 900,  0,		  0,   270, 8,"(M1?99 WT?120 M0_99 O0_1324 WT?20)") //⑤豆球 rgで消える
	set_chr( 68,664,	 8, 3,   900, 900,  0,		  0,     0, 8,"(M1?99 WT?120 M0_99 O0_1324 WT?20)") //⑤豆球 rgで消える

//■

	set_chr(11,145,		 7, 8,   900,   0,  0,		  2,   270, 0,";")	//⑦ とらんぷまん
	set_chr(12,151,		 7, 8,  -900,   0,  0,		  2,   270, 0,";")	//⑧ そるじゃ`
	set_chr(13,145,		 6, 7,   150,-150,  0,		  2,    90, 0,";")	//⑨ とらんぷまん
	set_chr(14,151,		 4, 7,   900,   0,  0,		  2,    90, 0,";")	//⑩ そるじゃ`

	set_chr(20,279,		 4, 5,   900, 200,  0,		  2,     0, 0,";")	//□a くろうぃすぷ
	set_chr(21,279,		 4, 5,   200, 900,  0,		  2,     0, 0,";")	//□b くろうぃすぷ
	set_chr(22,279,		 5, 6,  -900,-200,  0,		  2,     0, 0,";")	//□c くろうぃすぷ
	set_chr(23,279,		 5, 6,  -200,-900,  0,		  2,     0, 0,";")	//□d くろうぃすぷ

	set_chr(25,146,		 5, 3,     0,   0,  0,		  2,   180, 0,";")	//□ が`でぃあん
	set_chr(26,145,		 5, 2,   900,   0,  0,		  2,     0, 0,";")	//□ とらんぷまん
	set_chr(27,146,		 6, 3,     0,   0,  0,		  2,   180, 0,";")	//□ が`でぃあん

	set_chr(28,145,		 7, 5,   900,   0,  0,		  2,     0, 0,";")	//□ とらんぷまん
	set_chr(29,151,		 8, 4,     0,-900,  0,		  2,    90, 0,";")	//□ そるじゃ`


//■イベント
	EV("EV_SphereStone")
	EV("EV_CheckMetabo")

	// ④球石
	set_chr( 80,990,	 4, 5,   900, 200,  0,		  0,015454, 0,"z9_98")	// eれ浮上 


	//三月うさぎ
	// 89,97 穴
	// 1,49,88,87,86
	if ( !FR_71x_RabitDied )
	{
		if ( FR_711_RabitDone )
		{
			if ( !FR_712_RabitDone )
			{
				//■
				if ( !F2117 )
				{
				// 入口近く
					set_chr( 1,289,		 8, 7,  -200, 100,  0,		  0,     0, 0,"<EV_RabitFinish>;")	//① わ`らびっと 三月ウサギ  Lv15
				}
				else
				{
					// うさぎ扉前
					set_chr( 1,289,		 2, 7,   500,   0,  0,		  0,     0, 0,"<EV_RabitFinish>;")	//① わ`らびっと 三月ウサギ  Lv15
				}
	//			set_chr( 1,289,		 3, 7,   450,   0,  0,		  0,    90, 0,"<EV_RabitFinish>;")	//扉前
	//			set_chr( 1,289,		 1, 4,     0, 450,  0,		  0,   180, 0,"<EV_RabitFinish>;")	//デブ扉前
	//			set_chr( 1,289,		 1, 4,     0,-450,  0,		  0,   180, 0,"<EV_RabitFinish>;")	//デブ扉後

				if(IT_TAKARA<0)
				{
					set_chr( 49,560, 9, 7,  -250,   0,  0,		  6,   270,20,"<TK_TAKARA>;")	//①宝箱（上）ロック
					set_chr(171,990, 0, 0,     0,   0,  0,		  0,     0, 8,"F1 [0103] #3_88 WT?10 O1_18 <EV_RabitBoxFall> WT?27 #2_49;")	//宝箱を落とし、_けるようにする
				}
				else
				{
					set_chr( 49,560, 9, 7,  -250,   0,  0,		  7,   270, 0,";")				//①宝箱（上）空
					set_chr(171,990, 0, 0,     0,   0,  0,		  0,     0, 8,"F1 [0103] #3_88 WT?10 O1_18 <EV_RabitBoxFall> WT?27;")	//空箱
				}

				chr_equip_chr( 49, 1,"Bone_Spine", 100,   90,0,0,		0,  250, 0);	//背う箱

				//■イベント
				// セリフを出している之は宝箱
				set_chr( 88,990,	 0, 0,     0,   0,  0,		  0,     0, 8,"#3_49 (WT?30 L9?0100 [0120お茶会にWれちゃう！] WT?60[0103] WT?30 L9?0100 [0120出口どこよ！？]WT?60[0103] WT?120);")//せりふ

				// 到_判定-うさぎ穴
				set_chr( 87,990,	 0, 0,     0,   0,  0,		  0,     0, 8,"L2?8901 !F1 O1_18 D0_49 D0_1 <EV_Set712RabitDone> [0103] [8910さようなら～] WT?60[8903];")	// うさぎ到_

				// 到_判定-扉
				if ( !F2117 )
				{
					set_chr( 86,990,	 0, 0,     0,   0,  0,		  0,     0, 8,"L3?5001 !F1 O1_18 WT?10 C0_50 WT?30 M4_50 WT?30 C0_0 SF2117;")	// うさぎ扉 到_
				}

				EV("EV_RabitInit")
			}
		}
	}
	
	// うさぎ扉
	if ( F2117 )
	{
	// _きg
		MOT( 50, 6, 0 )
	}

//  -------  no typ   	  tip      x    y   z       mot     向 状  000+++++++010+++++++020+++++++030+++++++040+++++++050+++++++060+++++++070+++++++080+++++++090+++++++100+++++++110+++++++120+++++++130+++++++140+++++++150+++++++160+++++++170+++++++180+++++++190+++++++200+++++++210+++++++220+++++++230+++++++240+++++++250++
	// パイプ芋虫
	set_chr(  6,643,	 2, 5,     0,-150,  1,		  2,     0, 0,";")	//①き之こ 
	set_chr(  7,650,	 2, 5,     0,-150,  0,		  2,     0, 0,";"); //④苗床
	set_chr(  2,263,	 6, 5,     0,-150,  0,		  6,     0, 0,"#3_85;")	// キャタピリオン Lv15 + 3 = Lv18
		chr_equip2(  2,	"eq_166",	"Head_End", 105,		-5,0,110,	-9,0,0);
		chr_equip_chr(  2,  6, "obx0194", 100,	0,0,0,	0,0,380);	// 
		chr_state_LV( 2, 3);
	set_chr( 85,990,	 2, 5,     0,-150,  0,		  0,070202, 2,"<EV_TalkPipeCrawler>")	//パイプ芋虫会
		chr_equip_chr( 85, 6, "obx0194", 100,  90,0,0,		0, 0, 0);	//イベント

	// トカゲ之ビル
	set_chr(  3,266,	 2, 5,  -350,   0,  0,		  6,     0, 0,";")	//③ 青トカゲ②  Lv14

	// カナリア
	set_chr(  4,100,	 2, 5,   350,   0,  0,		  6,     0, 0,";")	//④ ズツツキ  Lv2 + 10 = Lv12
		chr_state_LV( 4, 10);

	// ド`ド`
	set_chr(  5,303,	 2, 5,   250,-250,  0,		  6,     0, 0,"I_FD32;")	//⑤ モサモサ  Lv12 + 2 = Lv14
		chr_state_LV( 5, 2);

	// 雪球距x
	set_chr(180,990,	 0, 0,     0,   0,  0,		  0,     0, 9,"RF110 Ly?6500 SF110")

	// 豆球
	set_chr( 77,990,	 7, 4,  1050, 750,  0,		  0,     0, 0,";")//カメラ用
	set_chr( 78,990,	 8, 3,   750,1050,  0,		  0,     0, 0,";")//カメラ用
	set_chr(181,990,	 0, 0,     0,   0,  0,		  0,     0, 9,"RF100 M1?67 M1?68 #3_67 #3_68 SF100;")
	set_chr(182,990,	 0, 0,     0,   0,  0,		  0,     0, 8,"!F2115 F100 SF2115 O1_18 WT?10       C0_78 WT?30 C0_77 WT?30 C0_53 WT?20 M4_53 WT?30 C0_0      ;")	// 雪球幼鏖_始前
	set_chr(183,990,	 0, 0,     0,   0,  0,		  0,     0, 3,"!F2115 F100 SF2115 O1_18 WT?10 #3_66 C0_78 WT?30 C0_77 WT?30 C0_53 WT?20 M4_53 WT?30 C0_0 #8_66;")	// 雪球幼鏖_始後
	if ( F2115 )
	{
	// すでにいちど点灯させた
		MOT( 53, 6, 0)	// 扉
		MOT( 67, 1, 0)	// 豆球on
		MOT( 68, 1, 0)	// 豆球on
	}

}

//--------------------------------------------------------------------
EV_CheckMetabo
{
	if ( !FR_712_FatDone )
	{
		if( F104 )
		{
			if( SP000>20 )
			{
				SE( 18, PLAYER1 )
				wait(30)

				MOT( 61, 4, 0 )
				SE( 240, 61 )
				wait(10)
				F_set( FR_712_FatDone )
			}
		}
	}

	wait(1)
	loop
}

//--------------------------------------------------------------------
EV_RabitInit
{
	color( 49,-1)		// 透明に
	F_set_chr( 49,		CF_NO_MINIMAP)	// 宝箱 ミニマップ非表示
	F_set_chr( 49,		CF_NO_CSP)
}

//--------------------------------------------------------------------
EV_RabitFinish
{
	color( 49,30)		// 不透明に
	F_reset_chr( 49,	CF_NO_MINIMAP)	// 宝箱 ミニマップ表示
	F_reset_chr( 49,	CF_NO_CSP)
	F_set(FR_7x_RabitDied)
}

//--------------------------------------------------------------------
EV_RabitBoxFall
{
	// 宝箱落下
	jump( 49,3, 24,-1,-1,0,150)
	wait_move(49)
}

//--------------------------------------------------------------------
EV_Set712RabitDone
{
	F_set(FR_712_RabitDone)
}

//--------------------------------------------------------------------
EV_Set712FatDone
{
	F_set(FR_712_FatDone)
}

//--------------------------------------------------------------------
EV_TalkPipeCrawler
{
	EV_begin()

	MOT(RAGNA,2,5)	//
	MOT(PATENER,2,5)	//
	MOT(PET,2,5)	//
	rot_chr(6,60,RAGNA)//虫とき之こ

	cross_fade(30)	//		クロスフェ`ド
	rot_chr(3,60,RAGNA)//トカゲ
	rot_chr(4,60,RAGNA)//とり
	rot_chr(5,60,RAGNA)//むさ
	CAM_move_chr( 6,30,0);
	wait(60)


	if (!FR_712_Talk1st)
	{
		MES(MUSHI,"你们是谁？",0)
		F_set(FR_712_Talk1st)
	}
	MES(MUSHI,"事物有合适的大小。",0)
	MES(MUSHI,"把对方变大。",0)
	MES(MUSHI,"还是自己变大。",0)
	MES_close(MUSHI)
	wait_MES(MUSHI)

	CAM_return( 30 )
	wait(30)

	EV_end()
}

//--------------------------------------------------------------------
EV_CQ1
{
	if (F110)
	{
		CAM_quake("4646")
	}
}

//--------------------------------------------------------------------
EV_SphereStone
{
	if ( !F65 )
	{
		EFF_chr(21520, 65, 0, 100, 0,"charbase0")
	}

	wait(25)
	loop
}

#EndScriptTable
//====================================================================

