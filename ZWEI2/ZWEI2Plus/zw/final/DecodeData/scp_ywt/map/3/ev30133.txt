//====================================================================
//ステージトラップスクリプト
//[13013][森－メイン③]
//====================================================================

#ScriptTable

//--------------------------------------------------------------------
//■グローバルフラグ・ルートフラグはev30113.txt参照

//■ローカルフラグ
// 100 中ボス警報
// 101 中ボス出現
// 102 ②敵 が出現
// 103 ③敵a が出現
// 104 ⑦敵a が出現
// 105 ⑦敵bcde が出現
// 106 ①苗床セット完了
// 107 ロケット発射＆扉閉じる
// 113 中ボスBGM管理

#PARTNER 	255
#PET 		254
#RAGNA 		0

#TREASURE_CH	48
#Fx_TREASURE	2321	//☆021シードラゴン

//--------------------------------------------------------------------
INIT
{
//環境SE
	SE(61,0)//鳥1
	SE(72,0)//鳥2

//■地形
	set_obj("obx011k",	 6, 6,    50,  50,  0,  180) //三角やぐら

//  -------  no typ   	  tip      x    y   z       mot     向 状  000+++++++010+++++++020+++++++030+++++++040+++++++050+++++++060+++++++070+++++++080+++++++090+++++++100+++++++110+++++++120+++++++130+++++++140+++++++150+++++++160+++++++170+++++++180+++++++190+++++++200+++++++210+++++++220+++++++230+++++++240+++++++250++
//■階段・扉
	set_chr( 90,990,	 5,10,     0,   0,  0,		180,  0201, 6,"K0_1;")		//①エントリ メイン②
	set_obj("@obx0013a", 5,10,     0,   0,  0,		180)						//①階段入（森緑）
	set_chr(190,1300,	 5,10,	   0,   0,  0,		  0,   180, 0,";")			//階段下（ダミー）

	set_chr( 91,990,	 3, 1,     0,   0,  0,		  0,  0201, 6,"K0_13019;")	//②エントリ 中継分岐
	set_obj("@obx0033a", 3, 1,     0,   0,  0,		  0)						//②アーチ（森緑）
	set_chr(109,622,	 3, 1,     0,   0,  0,		  0,     0, 0,";")			//②ゴール用天使
	set_chr(191,1400,	 3, 1,	   0,   0,  0,		  0,     0, 0,";")			//アーチ（ダミー）

	set_chr( 50,501,	 2, 6,   900,   0,  0,		  8,   270, 6,";")	//③扉（森） 一通
	set_chr( 51,501,	 4, 6,   900,   0,  0,		  6,    90, 0,";")	//③扉（森） 開放 中ボス部屋入口
	set_chr( 52,501,	 5, 5,     0,-900,  0,		  7,   180, 0,";")	//④扉（森） 閉鎖 出口
	set_chr( 53,501,	 6, 5,   500,   0,  0,		  7,    90, 0,";")	//⑤扉（森） 閉鎖 宝の部屋

//■スイッチ・看板
	set_chr( 55,658,	 5, 6,  -550,-190,  0,		  0,     0, 0,";")	//①中ボス看板
	set_chr( 56,804,	 5, 6,  -550,-190,115,		  0,     0, 8,"(L2?99 [9991ﾖｳﾌｫｿﾕﾄ｢ｹｽ] WT?30 L2!99 [9903] WT?30);")	//②看板
	set_chr( 57,650,	 5, 6,   900,-900,  0,		  2,     0, 0,";"); //③苗床

	if ( !F2106 )
	{
	// 初回
		set_chr( 58,570,	 1, 5,  -300,-300,  0,		  6,   315, 5,"M6?99 M5_99 SF2106;")	//④ボタンスイッチ
		set_chr(158,990,	 0, 0,     0,   0,  0,		  0,     0, 8,"F2106 O1_18 WT?10 C0_50 WT?20 M4_50 WT?30 C0_0;")//④ボタンスイッチ押下
	}
	else
	{
	// 押され
		set_chr( 58,570,	 1, 5,  -300,-300,  0,		  7,   315, 3,";")	//④ボタンスイッチ
		MOT( 50, 6, 0 )
	}

//■ハニワ・壷

	if ( !F2170 )
	{
		set_chr( 40,802,	 2, 7,  -400, 300,  0,		  2,     0, 0,"I_$$$1 SF2170 V4_140;")	//①壷
		set_chr(140,811,	 2, 7,  -400, 300,  0,		 -1,     0, 0,";")
	}
	else
	{
		set_chr(140,811,	 2, 7,  -400, 300,  0,		  0,     0, 0,";")
	}


	if ( !F2171 )
	{
		set_chr( 41,802,	 3, 7,     0,-100,  0,		  2,   120, 0,"I_$$$1 SF2171 V4_141;")	//②壷
		set_chr(141,811,	 3, 7,     0,-100,  0,		 -1,   120, 0,";")
	}
	else
	{
		set_chr(141,811,	 3, 7,     0,-100,  0,		  0,   120, 0,";")
	}


	if ( !F2172 )
	{
		set_chr( 42,802,	 3, 5,   150,   0,  0,		  2,   300, 0,"I_$$$1 SF2172 V4_142;")	//③壷
		set_chr(142,811,	 3, 5,   150,   0,  0,		 -1,   300, 0,";")
	}
	else
	{
		set_chr(142,811,	 3, 5,   150,   0,  0,		  0,   300, 0,";")
	}


	if ( !F2173 )
	{
		set_chr( 43,802,	 5, 4,     0, 200,  0,		  2,    90, 0,"I_$$$1 SF2173 V4_143;")	//④壷
		set_chr(143,811,	 5, 4,     0, 200,  0,		 -1,    90, 0,";")
	}
	else
	{
		set_chr(143,811,	 5, 4,     0, 200,  0,		  0,    90, 0,";")
	}


	if ( !F2174 )
	{
		set_chr( 44,802,	 4, 3,     0, 200,  0,		  2,   240, 0,"I_$$$1 SF2174 V4_144;")	//⑤壷
		set_chr(144,811,	 4, 3,     0, 200,  0,		 -1,   240, 0,";")
	}
	else
	{
		set_chr(144,811,	 4, 3,     0, 200,  0,		  0,   240, 0,";")
	}


//■宝箱
	set_chr( 49,626,	 3, 2,     0,-450,  0,		  0,     0,10,"!F2934 I_SLOT SF2934 <EV_SlotDarken>;")	//①スロットマシン
	if ( F2934 )
	{
		MOT( 49, 3, 1);
		EV("EV_SlotDarken")
	}

	if( !Fx_TREASURE )
		set_chr( TREASURE_CH,561,	 7, 5,     0,   0,  0,     6,    90,20,"<TK_TREASURE>;")	//②宝箱（上）
	else
		set_chr( TREASURE_CH,561,	 7, 5,     0,   0,  0,     7,    90, 0,";")	//②宝箱（上）


//■罠・障害物
	if ( !F2190 )
	{
		set_chr( 70,641,	 6, 6,    50,  50,550,		  5,   135, 0,"I_$$$2 SF2190;") ///①パラボラアンテナ
	}

//■敵
	// 中ボス
	if ( !F2100 )
	{
		set_chr(  1,358,	 5, 6,   900,-900, 1500,	 -1,     0, 9,"F101	V1_99 <EV_BossItemSpawner>;")	//①敵a キノコ人大
		set_chr(  3,210,	 5, 6,  1200,-600, 1500,	 -1,   315, 9,"F101	WT?25  V1_99;")	//①敵b またんご
		set_chr(  4,210,	 5, 6,   600,-1200,1500,	 -1,   135, 9,"F101	WT?45  V1_99;")	//①敵c またんご
		set_chr(  5,210,	 5, 6,   600,-600, 1500,	 -1,    45, 9,"F101	WT?75  V1_99;")	//①敵d またんご
		set_chr(  6,210,	 5, 6,  1200,-1200,1500,	 -1,   225, 9,"F101	WT?95  V1_99;")	//①敵e またんご
		set_chr(  7,210,	 5, 6,  1300,-900, 1500,	 -1,   270, 9,"F101	WT?125 V1_99;")	//①敵f またんご
		set_chr(  8,210,	 5, 6,   500,-900, 1500,	 -1,    90, 9,"F101	WT?165 V1_99;")	//①敵g またんご
		
		set_chr( 59,643,	 5, 5,   900, 200,  1,		  5,     0, 6,";")	//①きのこ

		set_chr( 80,990,	 0, 0,     0,   0,  0,		 0,     0, 8,"L1?5957 SF106;")// ①苗床接触
			// ここでまたんご大を消す
		set_chr( 81,990,	 0, 0,     0,   0,  0,		 0,     0, 8,"F100 S0_1 WT?120 #6_82;")//警報出現
		set_chr( 82,990,	 5, 6,   900,-900,  0,		 0,072323, 0,"M5_51 SF107;")//扉閉じる＆発射
		set_chr( 83,990,	 0, 0,     0,   0,  0,		 0,     0, 8,"F1 WT?10 O1_18 SF2100 <EV_NormalBGM> WT?30 #8_84;")
		set_chr( 84,990,	 0, 0,     0,   0,  0,		 0,     0, 3,"C0_53 WT?20 M4_51 M4_52 M4_53 WT?30 C0_0;")//中ボス戦闘終了

		// ロケット
		set_chr(150,990,	 0, 0,     0,   0,  0,		 0,     0, 8,"F106 <EV_RocketKinokoWait> WT?30 WT?30 [5920｣ｳ]WT?30[5903] SF100 WT?30 [5920｣ｲ]WT?30[5903] WT?30 [5920｣ｱ]WT?30[5903] WT?30;")	// ロケットキノコ-発射前
		set_chr(151,990,	 0, 0,     0,   0,  0,		 0,     0, 8,"F107 <EV_RocketKinokoGo> [5920cｻ WT?30 [5903] WT?30 [5920ﾆw] WT?30 [5903];")	// ロケットキノコ-発射後


		// 中ボスBGM
		set_chr(160,990,	 0, 0,     0,   0,  0,		  0,     0, 8,"(F113 <EV_BossBGM> WT?90 !F101 !F113 <EV_NormalBGM> WT?90);");
		set_chr(161,990,	 0, 0,     0,   0,  0,		  0,     0, 9,"!F2100 F101 SF113");	// ボスが生きていて、ボス戦闘中ならば113をセット
		set_chr(164,990,	 0, 0,     0,   0,  0,		  0,     0, 9,"!F2100 F107 SF113");	// ボスが生きていて、ロケット上昇済みならば113をセット
		set_chr(162,990,	 5, 6,   900,-900,  0,		  0,072323, 6,"!F2100 F100 SF113");		// ボスが生きていて、警報発動中ならば113をセット
		set_chr(163,990,	 0, 0,     0,   0,  0,		  0,     0, 9,"RF113");				// 103をクリア
	}
	else
	{
		set_chr( 83,990,	 0, 0,     0,   0,  0,		 0,     0, 8,"M7_52 M7_53;")
	}


	set_chr(  9,255,	 5, 5,   250,   0,  0,		  0,     0, 0,";")	//②敵 もりこぼると
		chr_equip2(9,	"eq_015",	"Bone_RightArm",100,		0,90,0,	0,25,0);	// スコップ
		chr_equip2(9,	"eq_162",	"Bone_Head",100,		25,0,0,	0,50,-10);	// 笠


	set_chr( 10,201,	 4, 9,     0, 250,  0,		 2,     0, 0,";") //③敵a まっどふらわー
	set_chr( 11,201,	 4, 9,  -450, -50,  0,		 2,   270, 0,";") //③敵b まっどふらわー
	set_chr( 12,201,	 4, 9,  -900, 250,  0,		 2,   270, 0,";") //③敵c まっどふらわー

	set_chr( 13,124,	 3, 8,     0, 200,400,		-1,     0, 9,"F102 V1_99;")//④敵 けさらん
	set_chr(180,990,	 3, 9,     0,-400,  0,		 0,070502, 6,"SF102;")//②敵 出現

	set_chr( 14,201,	 2, 8,     0,   0,  0,		-1,   270, 9,"F103 V3_99;") //⑤敵 まっどふらわー
	set_chr( 15,224,	 2, 8,     0,-200,  0,		-1,   270, 9,"F103 WT?15 V3_99;")//③敵b とまとにあん
	set_chr( 16,223,	 2, 8,     0,-400,  0,		-1,   270, 9,"F103 WT?30 V3_99;")//③敵c ぴーまん
	set_chr( 17,224,	 2, 8,     0, 200,  0,		-1,   270, 9,"F103 WT?15 V3_99;")//③敵d とまとにあん
	set_chr( 18,223,	 2, 8,     0, 400,  0,		-1,   270, 9,"F103 WT?30 V3_99;")//③敵e ぴーまん
	set_chr(181,990,	 2, 8,   500,   0,  0,		 0,070105, 6,"SF103;")//③敵 出現

	set_chr( 19,255,	 2, 7,    50,-150,  0,		  2,     0, 0,";")	//⑥敵 もりこぼると
		chr_equip2(19,	"eq_016",	"Bone_RightArm",100,		0,0,0,	0,25,0);	// 鍬
		chr_equip2(19,	"eq_162",	"Bone_Head",100,		25,0,0,	0,50,-10);	// 笠


	set_chr( 20,128,	 1, 5,     0,   0,  0,		  2,     0, 0,";") //⑦敵a ちゃりおっと 標準Lv12 + 追加Lv0 = 12
	set_chr( 21,255,	 1, 5,     0,   0,  0,		  2,     0, 0,";") //⑦敵b もりこぼると
		chr_equip_chr( 21, 20,"Null_Mon", 100,	0,  0,  180,	 0,0, 0);
		chr_equip2( 21,	"eq_015",	"Bone_RightArm",	100,		 60, 0,-30,	0,35,0);	// 釘バット
	set_chr(139,990,	 0, 0,     0,   0,  0,		  0,     0, 8,"F21 (!F20 M4_20 WT?15);") // ⑦敵 ちゃりおっと後始末

	set_chr( 22,223,	 1, 6,  -250,-250,  0,		 0,     0, 0,";")//⑧敵a ぴーまん
	set_chr( 23,223,	 1, 6,   250,-250,  0,		 0,     0, 0,";")//⑧敵b ぴーまん
	set_chr( 24,223,	 1, 6,  -250, 250,  0,		 0,     0, 0,";")//⑧敵c ぴーまん
	set_chr( 25,223,	 1, 6,   250, 250,  0,		 0,     0, 0,";")//⑧敵d ぴーまん

	set_chr( 26,224,	 2, 5,  -250,-250,  0,		 0,   270, 0,";")//⑨敵a とまとにあん
	set_chr( 27,224,	 2, 5,   250,-250,  0,		 0,   270, 0,";")//⑨敵b とまとにあん
	set_chr( 28,224,	 2, 5,  -250, 250,  0,		 0,   270, 0,";")//⑨敵c とまとにあん
	set_chr( 29,224,	 2, 5,   250, 250,  0,		 0,   270, 0,";")//⑨敵d とまとにあん


	set_chr( 30,124,	 3, 6,     0,   0,  0,		 2,315,	0,";")	//⑩敵 けさらん

	set_chr( 31,255,	 4, 4,     0, 600,  0,		 2,  0,	0,";")	//⑪敵 もりこぼると
		chr_equip2( 31,	"eq_017",	"Bone_RightArm",100,		0,0,0,	0,25,0);	// 三又農具
		chr_equip2( 31,	"eq_162",	"Bone_Head",100,		25,0,0,	0,50,-10);	// 笠

	set_chr( 32,210,	 3, 4,   900,-200,  0,		-1,   270, 9,"F104 WT?5 V3_99;")//⑫敵a またんご
	set_chr( 33,210,	 3, 4,   900, 200,  0,		-1,   270, 9,"F104 WT?5 V3_99;")//⑫敵b またんご
	set_chr(182,990,	 4, 4,  -450,   0,  0,		 2,   110, 6,"SF104;")//⑫敵a 出現

	set_chr( 34,201,	 3, 4,     0,   0,  0,		-1,   270, 9,"F105 WT?5 V3_99;")//⑬敵 まっどふらわー
	set_chr(183,990,	 3, 4,   700,   0,  0,		 2,   110, 6,"SF105;")//⑬敵 出現


//■イベント

//■場面固有設定

}

//--------------------------------------------------------------------
EV_BossItemSpawner
{
	set_chr(164,990,	 0, 0,     0,   0,  0,		  0,     0, 8,"F1 I_FFF3 I_FFF3 I_FFF3;");
	chr_equip_chr(164, 1,"Bone_Spine", 100,	0,0,0,	0,0,0);
}

//--------------------------------------------------------------------
EV_BossBGM
{
	stop_BGM(30)
	wait(30)
	BGM(35)
}

//--------------------------------------------------------------------
EV_NormalBGM
{
	stop_BGM(30)
	wait(30)
	BGM(23)
}

//--------------------------------------------------------------------
// 59=きのこ
// 57=苗床
EV_RocketKinokoWait
{
	// きのこの位置を苗床ぴったりに補正
	jump(59, 1,	15,	 57,0,20,	0)
	wait_move( 59 )
	SE(231,59)		// きのこ設置
	jump(59, 1,	15,	 57,0,0,	0)
	wait_move( 59 )

	SE(1331,59)		// ロケットキノコカウントダウン ループ
	EFF_chr( 21555, 59,	0,	100,	0,"obx0194")//秒読みの噴煙
	wait(30)

	EFF_chr( 21555, 59,	0,	100,	0,"obx0194")//秒読みの噴煙
	wait(30)
	EFF_chr( 21555, 59,	0,	100,	0,"obx0194")//秒読みの噴煙
	wait(30)

	EFF_chr( 21555, 59,	0,	100,	0,"obx0194")//秒読みの噴煙
	wait(30)
	EFF_chr( 21555, 59,	0,	100,	0,"obx0194")//秒読みの噴煙
	wait(30)

	EFF_chr( 21555, 59,	0,	100,	0,"obx0194")//秒読みの噴煙
	wait(30)
	EFF_chr( 21555, 59,	0,	100,	0,"obx0194")//秒読みの噴煙
	wait(30)
}

//--------------------------------------------------------------------
EV_RocketKinokoGo
{
	// ロケット発射
	EFF_chr(21550, 59,	0,	100,	0,"obx0194")
	EFF_chr(21557, 59,	0,	100,	0,"obx0194")//点火時の噴煙
	wait( 30 )

//	EFF_chr(21557, 59,	0,	150,	0,"obx0194")//点火時の噴煙
//	EFF_chr(21550, 59,	0,	100,	0,"obx0194")
//	wait( 30 )

	// 上昇
	stop_SE(1331)		// ロケットキノコカウントダウン ループストップ
	SE(1332,59)		// ロケットキノコ発射音
	EFF_chr(21550, 59,	0,	100,	0,"obx0194")
	jump(59, 2,	30,	 0,0,100,	0)
	wait_move( 59 )

	EFF_chr(21550, 59,	0,	100,	0,"obx0194")
	jump(59, 2,	20,	 0,0,300,	0)
	wait_move( 59 )

	EFF_chr(21550, 59,	0,	100,	0,"obx0194")
	jump(59, 2,	20,	 0,0,1000,	0)
	wait_move( 59 )

	color(59,-30)

	wait(90)
//	wait(60)
	F_set(101)		// ボス登場

}

//--------------------------------------------------------------------
EV_SlotDarken
{
	wait(15)
	color2( 49, 70,70,70,,0,0,0)		// スロット暗く
}

#EndScriptTable
//====================================================================

