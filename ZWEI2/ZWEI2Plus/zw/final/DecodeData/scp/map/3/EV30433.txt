//====================================================================
//ステ`ジトラップスクリプト
//[13043][森－サブ③]
//====================================================================

#ScriptTable

#PARTNER 	255
#PET 		254
#RAGNA 		0
#PIPIRO		1
#POCKLE		2

//--------------------------------------------------------------------
//■グロ`バルフラグ・ル`トフラグはev30413.txt参照

//■ロ`カルフラグ
// 100 ⑤吵霈F
// 101 □吵霈F。45f后102も立つ
// 102 □吵霈F。45f后101も立つ
// 105 スポットon/off
// 106 主人公在水地
// 107 主人公在水中
// 110 PLAYER20が生きていて，靠近主人公
// 111 PLAYER21が生きていて，靠近主人公
// 112 PLAYER22が生きていて，靠近主人公
// 120 宝箱ジャンプ_始

#TREASURE_CH	48
#Fx_TREASURE	2313	//☆013エメラルド

//--------------------------------------------------------------------
INIT
{
//h境SE
	SE(61,0)//B1
	SE(72,0)//B2

//■地形
	set_obj("obx0514",	 5, 6,  250,   0,  0,	 0) //穴
	set_obj("obx0514",	 6, 5,    0,   0,  0,	 0) //穴
	set_obj("obx0514",	 2, 7, -250,   0,  0,	 0) //穴

	set_obj2("mp10202",  1,10, -450,-450,  0,	 0) //
	set_obj2("mp10222",  1,10, -450, 450,  0,	 0) //
	set_obj2("mp10212",  1,10,  450,-450,  0,	 0) //
	set_obj2("mp10232",  1,10,  450, 450,  0,	 0) //
	set_obj("mp10162",   0, 9,  450,-450,  0,	 0) //
	set_obj("mp10162",   1, 9,  450,-450,  0,	 0) //
	set_obj("mp10162",   0,10, -450,-450,  0,	 0) //
	set_obj("mp10162",   2,10, -450,-450,  0,	 0) //
	set_obj("mp10162",   0,11,  450,-450,  0,	 0) //
	set_obj("mp10162",   1,11,  450,-450,  0,	 0) //

	set_obj2("mp10002",  1, 2, -450,-450,  0,	 0) //
	set_obj2("mp10022",  1, 2, -450, 450,  0,	 0) //
	set_obj2("mp10092",  1, 2,  450,-450,  0,	 0) //
	set_obj2("mp10112",  1, 2,  450, 450,  0,	 0) //
	set_obj2("mp10002",  2, 1, -450,-450,  0,	 0) //
	set_obj2("mp10142",  2, 1, -450, 450,  0,	 0) //
	set_obj2("mp10012",  2, 1,  450,-450,  0,	 0) //
	set_obj2("mp10152",  2, 1,  450, 450,  0,	 0) //
	set_obj2("mp10242",  2, 2, -450,-450,  0,	 0) //
	set_obj2("mp10502",  2, 2, -450, 450,  0,	 0) //
	set_obj2("mp10452",  2, 2,  450,-450,  0,	 0) //
	set_obj2("mp10232",  2, 2,  450, 450,  0,	 0) //
	set_obj("mp10162",   1, 1, -450,-450,  0,	 0) //
	set_obj("mp10162",   1, 3, -450,-450,  0,	 0) //
	set_obj("mp10162",   2, 3, -450,-450,  0,	 0) //
	set_obj("mp10162",   3, 3, -450,-450,  0,	 0) //
	set_obj("mp10162",   3, 2, -450,-450,  0,	 0) //
	set_obj("mp10162",   3, 1, -450,-450,  0,	 0) //
	set_obj("mp10162",   0, 1, -450, 450,  0,	 0) //
	set_obj("mp10162",   0, 2, -450, 450,  0,	 0) //
	set_obj("mp10162",   1, 0,  450,-450,  0,	 0) //
	set_obj("mp10162",   2, 0,  450,-450,  0,	 0) //

	set_obj("@obx0300",   8, 5,900,900,  0,	 0) //水面

//  -------  no typ   	  tip      x    y   z       mot     向 状  000+++++++010+++++++020+++++++030+++++++040+++++++050+++++++060+++++++070+++++++080+++++++090+++++++100+++++++110+++++++120+++++++130+++++++140+++++++150+++++++160+++++++170+++++++180+++++++190+++++++200+++++++210+++++++220+++++++230+++++++240+++++++250++
//■A段

	set_chr( 90,990,	 5,10,     0,   0,  0,		180,  0201, 6,"K0_1;")	//①エントリ サブ②
	set_obj("@obx0013a", 5,10,     0,   0,  0,		180)					//①A段入（森v）
	set_chr(190,1300,	 5,10,	   0,   0,  0,		  0,   180, 0,";")			//A段下（ダミ`）

	set_chr( 91,990,	 8, 7,     0,   0,  0,		180,  0201, 6,"K0_13049;")	//②エントリ サブK
	set_obj("@obx0033a", 8, 7,     0,   0,  0,		180)						//②ア`チ（森v）
	set_chr(109,622,	 8, 7,     0,   0,  0,		  0,   180, 0,";")			//②ゴ`ル用天使
	set_chr(191,1400,	 8, 7,	   0,   0,  0,		  0,   180, 0,";")			//ア`チ（ダミ`）

	set_chr( 92,990,	 5, 6,   250,   0,  0,		 90,070808, 6,"k5_0 F105 RF105 L0_00 <EV_ConfigureMainFloor>")	//エントリ
	set_chr( 93,990,	 6, 5,     0,   0,  0,		  0,070808, 6,"k6_0 F105 RF105 L0_00 <EV_ConfigureMainFloor>")	//エントリ
	set_chr( 94,990,	 2, 7,  -250,   0,  0,		  0,070808, 6,"k7_0 F105 RF105 L0_00 <EV_ConfigureMainFloor>")	//エントリ
	set_chr(150,990,	 1, 2,   200,   0,  0,		  0,070808, 6,"    !F105 SF105 L1_70 <EV_ConfigureSubFloor>")		//③地下
	set_chr(151,990,	 2, 1,     0, 200,  0,		  0,070808, 6,"    !F105 SF105 L1_70 <EV_ConfigureSubFloor>")		//④地下
	set_chr(152,990,	 1,10,     0,-250,  0,		  0,070808, 6,"    !F105 SF105 L1_70 <EV_ConfigureSubFloor>")		//⑤地下

	set_chr( 95,672,	 1, 2,   200,   0,  0,		  0,   270, 6,"K8_3")		//③ジャンプ台
	set_chr( 96,672,	 2, 1,     0, 200,  0,		  0,     0, 6,"K9_3")		//④ジャンプ台
	set_chr( 97,672,	 1,10,     0,-250,  0,		  0,    90, 6,"Ka_3")		//⑤ジャンプ台

	set_chr( 98,990,	 5, 6,   250,   0,600,		 90,     0, 0,";")		//⒙纷ㄓ
	set_chr( 99,990,	 6, 5,     0,   0,600,		180,     0, 0,";")		//⒙纷ㄓ
	set_chr(100,990,	 2, 7,  -250,   0,600,		270,     0, 0,";")		//⒙纷ㄓ

//■スイッチ・看板
	set_chr( 55,804,	 4, 9,  -275,  50,  0,		  0,   270, 8,"(L2?99 [9991→＿白貂族居住地\n↓＿大耳兽王国] WT?30 L2!99 [9903] WT?30);")	//①看板
	set_chr( 56,804,	 4, 6,   300,-250,  0,		  0,     0, 8,"(L2?99 [9991前方坟墓→] WT?30 L2!99 [9903] WT?30);")	//②看板
	set_chr( 57,672,	 7, 3,   -50,-150,  0,		  0,   105, 6,"<EV_JUMP1>")		//③ジャンプ台
	set_chr( 58,672,	 8, 4,   350,  50,  0,		  0,   285, 6,"<EV_JUMP2>")		//④ジャンプ台
	set_chr( 59,655,	 6, 3,   900,-225,  0,		  2,     0, 0,";")	//⑤路案内

//■F・障害物
	if ( !F2190 )
	{
		set_chr( 65,642,	 3, 5,     0,-150,  0,		  2,     0, 0,"D1_41 I_BBB1 SF2190;")	//①岩 御神体
	}

	// F2191 ②岩はうしろ

	if ( !F2192 )
	{
		set_chr( 67,633,	 6, 3,  -110, 250,  0,		  2,   102, 0,"SF2192;")	//③ヒビ壁a 前方後
	}

	if ( !F2193 )
	{
		set_chr( 68,633,	 6, 3,   310, 250,  0,		  2,   258, 0,"SF2193;")	//③ヒビ壁b 前方後
	}

	if ( !F2194 )
	{
		set_chr( 69,633,	 6, 3,   100, 500,  0,		  2,     0, 0,"SF2194;")	//③ヒビ壁c 前方後
	}


	if ( !F2140 )
		set_chr( 70,630,	 3, 8,   -50,-900,  0,		  2,    45, 0,"I_$$$1 SF2140;")	//③樽
	else
		set_chr( 70,630,	 3, 8,   -50,-900,  0,		  2,    45, 0,"I_$$$1;")	//③樽

	if ( !F2141 )
		set_chr( 71,630,	 3, 6,   900, -50,  0,		  2,   135, 0,"I_$$$1 SF2141;")	//④樽
	else
		set_chr( 71,630,	 3, 6,   900, -50,  0,		  2,   135, 0,"I_$$$1;")	//④樽


	set_chr( 72,991,	 8, 5,     0,   0,  0,		240,020101, 0,";")	//⑤H
	if ( !F2142 )
		set_chr( 73,630,	 8, 5,     0,   0,  0,		  2,   240, 0,"I_$$$2 D0_72 SF2142;")	//⑤樽 (浮)
	else
		set_chr( 73,630,	 8, 5,     0,   0,  0,		  2,   240, 0,"I_$$$1 D0_72;")	//⑤樽 (浮)
//	chr_equip_chr( 73, 72,"TG1", 100,	0,0,180,	0,0,0);
	EV("EV_FloatingBarrel")


	if ( !F2196 )
	{
		set_chr( 74,639,	 3, 5,  -350, 300,  0,		  2,     0, 8,"M0?99 SF2196;") //⑥砂之柱a
	}

	if ( !F2197 )
	{
		set_chr( 75,639,	 3, 5,   350, 300,  0,		  2,     0, 8,"M0?99 SF2197;") //⑥砂之柱b
	}

	set_chr(110,627,	 8, 4,     0,-900,  0,		  0,     0, 0,";")	// 判
	set_chr(111,627,	 8, 7,     0, 900,  0,		  0,     0, 0,";")	// 判


//■ハニワ・

	if ( !F2170 )
	{
		set_chr( 40,802,	 1,10,   -175,350,  0,		  2,     0, 0,"I_$$$1 SF2170 V4_140;")	//①
		set_chr(140,811,	 1,10,   -175,350,  0,		 -1,     0, 0,";")
	}
	else
	{
		set_chr(140,811,	 1,10,   -175,350,  0,		  0,     0, 0,";")
	}


	if ( !F2171 )
	{
		set_chr( 41,634,	 1,10,    175,350,  0,		  2,   180, 0,"I_US01 SF2171 V4_141;")	//②ハニワ
		set_chr(141,812,	 1,10,    175,350,  0,		 -1,   180, 0,";")
	}
	else
	{
		set_chr(141,812,	 1,10,    175,350,  0,		  0,   180, 0,";")
	}


	if ( !F2172 )
	{
		set_chr( 42,634,	 3, 5,     0,-150,  0,		  2,     0, 0,"I_$$$3 I_BBB1 SF2172 V4_142;")	//③ハニワ 御神体
		set_chr(142,812,	 3, 5,     0,-150,  0,		 -1,     0, 0,";")
		if ( !F2190 )
		{
			chr_equip_chr(42,65,"body", 175,  0,0,0,	0, 0,150);
		}
	}
	else
	{
		set_chr(142,812,	 3, 5,     0,-150,  0,		  0,     0, 0,";")
	}
	chr_scale(142,	"root",	225,225,225,		0,	0);


//	if ( !F2173 )
//	{
//		set_chr( 43,802,	 0, 0,     0,   0,  0,		  2,     0, 0,"I_$$$1 SF2173 V4_143;")	//④
//		set_chr(143,811,	 0, 0,     0,   0,  0,		 -1,     0, 0,";")
//	}
//	else
//	{
//		set_chr(143,811,	 0, 0,     0,   0,  0,		  0,     0, 0,";")
//	}


	if ( !F2174 )
	{
		set_chr( 44,634,	 2, 2,   250, 350,  0,		  2,    60, 0,"I_US01 SF2174 V4_144;")	//⑤ハニワ
		set_chr(144,812,	 2, 2,   250, 350,  0,		 -1,    60, 0,";")
	}
	else
	{
		set_chr(144,812,	 2, 2,   250, 350,  0,		  0,    60, 0,";")
	}


	if ( !F2175 )
	{
		set_chr( 45,634,	 6, 3,   100, 250,  0,		  2,     0, 0,"I_$$$3 I_US01 SF2175 V4_145;")	//⑥ハニワ 前方後
		set_chr(145,812,	 6, 3,   100, 250,  0,		 -1,     0, 0,";")
	}
	else
	{
		set_chr(145,812,	 6, 3,   100, 250,  0,		  0,     0, 0,";")
	}


	if ( !F2176 )
	{
		set_chr( 46,802,	 9, 5,   -50,  50,  0,		  2,     0, 0,"I_$$$1 SF2176 V4_146;")	//⑦
		set_chr(146,811,	 9, 5,   -50,  50,  0,		 -1,     0, 0,";")
	}
	else
	{
		set_chr(146,811,	 9, 5,   -50,  50,  0,		  0,     0, 0,";")
	}


//■宝箱
	set_chr( 49,626,	 8, 6,   150, 150,  0,		  0,     0,10,"!F2938 I_SLOT SF2938 <EV_SlotDarken>;")	//①スロットマシン
	if ( F2938 )
	{
		MOT( 49, 3, 1);
		EV("EV_SlotDarken")
	}

	// 前方後之宝 48
	if ( !F2103 )
	{
		if ( !F2191 )
		{
			set_chr( 66,642,	 6, 3,   100,-175,  0,		  2,     0, 0,"#8_30 SF2191;")	//②岩 前方後
		}
		else
		{
			set_chr(172,990,	 0, 0,     0,   0,  0,		  0,     0, 8,"#2_173;");
			F_set( 66 )
		}

		if( !Fx_TREASURE )
		{
			set_chr( TREASURE_CH,561,	 6, 3,   100,-175,-100,	   -1,     0,20,"<TK_TREASURE>;")	// ④宝箱（上）
			set_chr(171,990,			 6, 3,   100,-175,   0,	   -1,     0, 3,"#8_99 <EV_Kokohore> WT?30 O1_18 #2_48;");
		}
		else
		{
			set_chr( TREASURE_CH,561,	 6, 3,   100,-175,-100,	    7,     0, 3,";")	// ④宝箱（上）
			color(TREASURE_CH,-1)
			set_chr(171,990,			 6, 3,   100,-175,   0,	   -1,     0, 3,"#8_99 <EV_Kokohore> WT?30 O1_18 #3_48;");
		}
		F_set_chr(TREASURE_CH,CF_NO_CSP)
		set_chr(174,990,			 0, 0,     0,   0,   0,	    0,     0, 8,"#3_48 F66 WT?90 #2_173;");

		if( !Fx_TREASURE )
		{
		 	set_chr(173,990,	 6, 3,   100,-175,  0,		  0,     0, 3,"#8_99 V4_48 M6_48 #3_48 WT?15 #2_171;")
		}
		else
		{
		 	set_chr(173,990,	 6, 3,   100,-175,  0,		  0,     0, 3,"#8_99 V4_48 M7_48 #3_48 WT?15 #2_171;")
		}
	}
	else
	{
		if( !Fx_TREASURE )
		{
			set_chr( TREASURE_CH,561,	 6, 3,   100,-175,  15,	    6,     0,20,"<TK_TREASURE>;")	// ④宝箱（上）
		}
		else
		{
			set_chr( TREASURE_CH,561,	 6, 3,   100,-175,  15,	    7,     0, 3,";")	// ④宝箱（上）
		}
	}


//■
	set_chr(  2,256,	 1,10,   275,-275,  0,		  2,     0, 0,";") //①a もりおこじょ

	set_chr(  4,256,	 2, 2,     0,-600,  0,		  2,     0, 0,";") //②a もりおこじょ
	set_chr(  5,256,	 2, 2,  -600,   0,  0,		  2,     0, 0,";") //②b もりおこじょ

	set_chr(  7,256,	 4, 8,     0,   0,  0,		  2,   180, 0,";") //③ もりおこじょ
	set_chr(  8,256,	 4, 6,     0,-800,  0,		  2,     0, 0,";") //④ もりおこじょ

	set_chr(  9,218		 3, 6,   550,  50,  0,		 -1,   270, 8,"F100 WT?05 V2_99;") //⑤ すぷらいと
	set_chr( 10,218		 3, 6,   -50, -50,  0,		 -1,   315, 8,"F100 WT?15 V2_99;") //⑤ すぷらいと
	set_chr( 11,218		 3, 6,   -50, 550,  0,		 -1,     0, 8,"F100 WT?05 V2_99;") //⑤ すぷらいと

	set_chr( 12,256,	 5, 6,  -100,   0,  0,		  2,    90, 0,";") //⑥ もりおこじょ
	set_chr( 13,256,	 2, 7,   100,   0,  0,		  2,   270, 0,";") //⑦ もりおこじょ

	set_chr( 14,256,	 4, 7,   900,   0,  0,		  2,    90, 0,";") //□ もりおこじょ

	set_chr( 15,256,	 7, 3,  -300, 300,  0,		  2,   270, 0,";") //⑧ もりおこじょ
	set_chr( 16,150,	 7, 3,  -900,  50,500,		 -1,     0, 8,"F101 WT?05 V1_99;") //□ あるけに`
	set_chr( 17,150,	 7, 3,   -50, 900,500,		 -1,   180, 8,"F102 WT?05 V1_99;") //□ あるけに`

	set_chr( 20,268,	 8, 5,   900,   0,  0,		  2,   270, 0,";") //⑨ もりいわがえる

	set_chr( 21,104,	 9, 6,  -100,-450,  0,		  2,   180, 0,";") //⑩a あばどん
	set_chr( 22,268,	 9, 6,  -100, 150,  0,		  2,    90, 0,";") //⑩b もりいわがえる

	set_chr( 30,222,	 6, 3,   100,-175,  0,		 -1,     0, 0,"WT?35 V3_99;")  //□ ぞんび Lv13 + 追加Lv1 = 14
		chr_state_LV(30, 1);
		chr_equip2(30,	"eq_100",	"Bone_Head",	85,		0,0,0,	0,20,0);

//■イベント
	set_chr( 80,990,	 3, 6,     0,   0,  0,		  0,  1818, 6,"SF100;")	// ⑤偿ē辚
	set_chr( 81,990,	 7, 3,  -900, 150,  0,		  0,  0508, 6,"SF101 WT?45 SF102;")	// □偿ē辚
	set_chr( 82,990,	 7, 3,  -150, 900,  0,		  0,  0805, 6,"SF102 WT?45 SF101;")	// □偿ē辚

	set_chr( 87,990,	 9, 6,  -900,-900,  0,		  0,023695, 6,"SF107")	// 主人公在水中?: フラグセット
	set_chr( 88,990,	 9, 6,  -900,-900,  0,		  0,  3695, 6,"SF106")	// 主人公在水地?: フラグセット
	set_chr( 89,990,	 0, 0,     0,   0,  0,		  0,     0, 9,"RF106 RF107")	// 主人公在水地?: フラグリセット

	set_chr(161,990,	 0, 0,     0,   0,  0,		  0,     0, 9,"!F20 RF110 Lf?2000 SF110")	// PLAYER20が生きていて，靠近主人公
	set_chr(162,990,	 0, 0,     0,   0,  0,		  0,     0, 9,"!F21 RF111 Lf?2100 SF111")	// PLAYER21が生きていて，靠近主人公
	set_chr(163,990,	 0, 0,     0,   0,  0,		  0,     0, 9,"!F22 RF112 Lf?2200 SF112")	// PLAYER21が生きていて，靠近主人公

//■场面固有O定
	map_color(100,100,100,0);//R,G,B, time 100%
	map_spotbmp(0);//100%
	EV("EV_Splash")
}

//--------------------------------------------------------------------
EV_JUMP1
{
	//	ch,typ	tim,xyz		高さ
	jump(PLAYER1,2,	34,	1600,-2000,0,	500)
	jump(PLAYER2,2,	34,	1600,-2000,0,	500)
	jump(PET,2,	34,	1600,-2000,0,	500)
	wait_move( PLAYER1 )

	SE(1323, 0)// 着水
	// 水面ダイブ
	EFF_chr(4007, RAGNA,   0, 100, 0, "Bone_Hips")
	EFF_chr(4007, PARTNER, 0, 100, 0, "Bone_Hips")
	EFF_chr(4007, PET, 0, 100, 0, "Bone_Hips")

}

//--------------------------------------------------------------------
EV_JUMP2
{
	// 水面ダイブ
	EFF_chr(4007, RAGNA,   0, 100, 0, "Bone_Hips")
	EFF_chr(4007, PARTNER, 0, 100, 0, "Bone_Hips")
	EFF_chr(4007, PET, 0, 100, 0, "Bone_Hips")

	//	ch,typ	tim,xyz		高さ
	jump(PLAYER1,2,	34,	-2000,1600,0,	500)
	jump(PLAYER2,2,	34,	-2000,1600,0,	500)
	jump(PET,2,	34,	-2000,1600,0,	500)

	wait_move( PLAYER1 )
}

//--------------------------------------------------------------------
EV_FloatingBarrel
{
	if ( !F73 )
	{
#BARREL1	73
		jump( BARREL1, 2, 8, 0,0,2,  0)
		wait_move( BARREL1 )
		jump( BARREL1, 2, 24, 0,0,15,  0)
		wait_move( BARREL1 )
		jump( BARREL1, 2, 8, 0,0,2,  0)
		wait_move( BARREL1 )
		jump( BARREL1, 2, 8, 0,0,-2,  0)
		wait_move( BARREL1 )
		jump( BARREL1, 2, 24, 0,0,-15,  0)
		wait_move( BARREL1 )
		jump( BARREL1, 2, 8, 0,0,-2,  0)
		wait_move( BARREL1 )

		loop
	}
}

//--------------------------------------------------------------------
EV_Splash
{
	// 主人公が水エリアにいる
	if(F106)
	{
		//EFF_chr(no,Ch,rot,size%,tgCh,"node")

		// 主人公が着地中
		if(F107)
		{
			EFF_chr(4010, RAGNA,   0, 100, 0, "Bone_Hips")
			EFF_chr(4010, PARTNER, 0, 100, 0, "Bone_Hips")
			EFF_chr(4010, PET, 0, 100, 0, "Bone_Hips")
		}

		if(F110)
		{
			EFF_chr(4010, 20,  0, 100, 0, "Bone_Hips") //⑨ もりいわがえる
		}

		if(F111)
		{
			EFF_chr(4010, 21,  0, 100, 0, "Bone_Hip") //⑩a あばどん		こいつ之场合，名前は"Bone_Hip"で正しい
		}

		if(F112)
		{
			EFF_chr(4010, 22,  0, 100, 0, "Bone_Hips") //⑩b もりいわがえる
		}

	}
	wait( 25 )

	loop
}

//--------------------------------------------------------------------
EV_ConfigureSubFloor
{
	MOT(0, 2, 0)
	F_set_chr(TREASURE_CH, CF_NO_MINIMAP)	// 宝箱 mini地图非表示
}

//--------------------------------------------------------------------
EV_ConfigureMainFloor
{
	F_reset_chr(TREASURE_CH, CF_NO_MINIMAP)	// 宝箱 mini地图非表示
}

//--------------------------------------------------------------------
EV_SlotDarken
{
	wait(15)
	color2( 49, 70,70,70,,0,0,0)		// スロット暗く
}

//--------------------------------------------------------------------
EV_AppearBox
{
	color( TREASURE_CH, 30);
}

//--------------------------------------------------------------------
EV_Kokohore
{
	F_set(2103)
	F_reset_chr(TREASURE_CH,CF_NO_CSP)
	jump(48,3, 25,-1,-1, 0, 150)
}

#EndScriptTable
//====================================================================

